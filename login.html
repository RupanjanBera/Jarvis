<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>J.A.R.V.I.S. Login</title>
  <link rel="icon" href="https://jarvisai30.vercel.app/arc.png">
  <link rel='stylesheet' href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css'>
  <link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Poppins&amp;display=swap'>
  
  <!-- Google OAuth -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    /* ============================================
       EXACT COPY FROM style.css
    ============================================ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }

    :root {
      --primary-color: #c6c3c3;
      --second-color: #ffffff;
      --black-color: #000000;
    }

    body {
      background-image: url("https://codingstella.com/wp-content/uploads/2024/01/download-6-scaled.jpeg");
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }

    a {
      text-decoration: none;
      color: var(--second-color);
    }

    a:hover {
      text-decoration: underline;
    }

    .wrapper {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: rgba(0, 0, 0, 0.2);
    }

    /* ============================================
       J.A.R.V.I.S. Glassmorphism Card
    ============================================ */
    .login_box {
      position: relative;
      width: 450px;
      backdrop-filter: blur(25px);
      border: 2px solid var(--primary-color);
      border-radius: 15px;
      padding: 7.5em 2.5em 4em 2.5em;
      color: var(--second-color);
      box-shadow: 0px 0px 10px 2px rgba(0, 0, 0, 0.2);
    }

    /* Improved J.A.R.V.I.S. Header */
    .login-header {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-color: var(--primary-color);
      width: 200px;
      height: 80px;
      border-radius: 0 0 20px 20px;
      z-index: 10;
    }

    .login-header h1 {
      font-size: 26px;
      color: var(--black-color);
      font-weight: 700;
      letter-spacing: 3px;
      text-transform: uppercase;
      margin-bottom: 5px;
    }

    .login-header .subtitle {
      font-size: 11px;
      color: var(--black-color);
      text-transform: uppercase;
      letter-spacing: 2px;
      font-weight: 600;
    }

    .login-header::before {
      content: "";
      position: absolute;
      top: 0;
      left: -30px;
      width: 30px;
      height: 30px;
      border-top-right-radius: 50%;
      background: transparent;
      box-shadow: 15px 0 0 0 var(--primary-color);
    }

    .login-header::after {
      content: "";
      position: absolute;
      top: 0;
      right: -30px;
      width: 30px;
      height: 30px;
      border-top-left-radius: 50%;
      background: transparent;
      box-shadow: -15px 0 0 0 var(--primary-color);
    }

    /* ============================================
       Input Fields (EXACT same as index.html)
    ============================================ */
    .input_box {
      position: relative;
      display: flex;
      flex-direction: column;
      margin: 20px 0;
    }

    .input-field {
      width: 100%;
      height: 55px;
      font-size: 16px;
      background: transparent;
      color: var(--second-color);
      padding-inline: 20px 50px;
      border: 2px solid var(--primary-color);
      border-radius: 30px;
      outline: none;
    }

    .label {
      position: absolute;
      top: 15px;
      left: 20px;
      transition: 0.2s;
      color: var(--primary-color);
      pointer-events: none;
    }

    .input-field:focus ~ .label,
    .input-field:valid ~ .label {
      position: absolute;
      top: -10px;
      left: 20px;
      font-size: 14px;
      background-color: var(--primary-color);
      border-radius: 30px;
      color: var(--black-color);
      padding: 0 10px;
    }

    .icon {
      position: absolute;
      top: 18px;
      right: 25px;
      font-size: 20px;
      color: var(--primary-color);
    }

       /* ============================================
       Google Login Button - Glassmorphism Style
    ============================================ */
    .google-wrapper {
      position: relative;
      width: 100%;
      height: 50px; /* EXACT same as .input-submit height */
      margin: 20px 0;
      border-radius: 30px; /* EXACT same as .input-submit */
      backdrop-filter: blur(25px); /* Match main blur */
      background: rgba(236, 236, 236, 0.1); /* Match .input-submit base */
      border: 2px solid var(--primary-color); /* Same border */
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: 0.3s; /* Add transition like .input-submit */
    }

    .google-wrapper:hover {
      background: rgba(255, 255, 255, 0.2); /* Hover effect */
    }

    .google-wrapper::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 30px;
    }

    #googleSignInBtn {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      background: transparent;
      border: none;
      color: var(--second-color); /* White text like guest button */
      font-size: 16px; /* EXACT same as .input-submit */
      font-weight: 500; /* EXACT same as .input-submit */
      cursor: pointer;
      padding: 0 30px;
      font-family: "Poppins", sans-serif; /* Match font */
    }

    #googleSignInBtn:hover {
      color: var(--black-color); /* Match .input-submit hover text color */
    }

    #googleSignInBtn i {
      font-size: 22px;
    }
 
    /* ============================================
       Buttons (EXACT same as index.html)
    ============================================ */
    .input-submit {
      width: 100%;
      height: 50px;
      background: #ececec;
      font-size: 16px;
      font-weight: 500;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      transition: 0.3s;
      color: var(--black-color);
      margin-top: 10px;
    }

    .input-submit:hover {
      background: var(--second-color);
    }

    .btn-guest {
      width: 100%;
      height: 50px;
      background: transparent;
      border: 2px solid var(--primary-color);
      border-radius: 30px;
      color: var(--second-color);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: 0.3s;
      margin-top: 10px;
    }

    .btn-guest:hover {
      background: var(--primary-color);
      color: var(--black-color);
    }

    /* ============================================
       Divider
    ============================================ */
    .divider {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 20px 0;
      color: var(--primary-color);
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .divider::before,
    .divider::after {
      content: "";
      flex: 1;
      height: 1px;
      background: var(--primary-color);
      margin: 0 15px;
    }

    /* ============================================
       Links & Navigation - Improved Styling
    ============================================ */
    .remember-forgot {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 15px;
      margin: 15px 0;
      color: var(--primary-color);
    }

    .remember-me {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .remember-me input[type="checkbox"] {
      accent-color: var(--primary-color);
    }

    .forgot button {
      background: transparent;
      border: none;
      color: var(--primary-color);
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      padding: 5px 0;
    }

    .forgot button:hover {
      color: var(--second-color);
      text-decoration: underline;
    }

    .login-nav {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 25px;
      padding-top: 20px;
      border-top: 1px solid rgba(198, 195, 195, 0.3);
    }

    .login-nav button {
      background: transparent;
      border: none;
      color: var(--primary-color);
      font-size: 15px;
      cursor: pointer;
      padding: 8px 16px;
      font-weight: 500;
      border-radius: 20px;
      transition: all 0.3s;
    }

    .login-nav button:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--second-color);
    }

    .register {
      text-align: center;
      margin-top: 25px;
      color: var(--primary-color);
      font-size: 15px;
    }

    .register button {
      background: transparent;
      border: none;
      color: var(--second-color);
      font-weight: 600;
      cursor: pointer;
      padding: 0 5px;
    }

    .register button:hover {
      text-decoration: underline;
    }

    /* ============================================
       View Headers - Consistent Styling
    ============================================ */
    .view-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(198, 195, 195, 0.3);
    }

    .view-title {
      font-size: 22px;
      color: var(--second-color);
      font-weight: 600;
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .view-subtitle {
      font-size: 13px;
      color: var(--primary-color);
      text-transform: uppercase;
      letter-spacing: 1.5px;
    }

    /* ============================================
       View System
    ============================================ */
    .view {
      display: none;
    }

    .view.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ============================================
       Status Messages
    ============================================ */
    .status-msg {
      text-align: center;
      margin-top: 20px;
      padding: 12px;
      border-radius: 30px;
      font-size: 14px;
      font-weight: 500;
      background: rgba(255, 255, 255, 0.1);
      color: var(--second-color);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .text-error {
      background: rgba(255, 51, 51, 0.1);
      color: #ff3333;
      border-color: rgba(255, 51, 51, 0.3);
    }

    .text-success {
      background: rgba(0, 255, 136, 0.1);
      color: #00ff88;
      border-color: rgba(0, 255, 136, 0.3);
    }

    /* ============================================
       Responsive Design
    ============================================ */
    @media only screen and (max-width: 564px) {
      .wrapper {
        padding: 20px;
      }

      .login_box {
        padding: 7.5em 1.5em 4em 1.5em;
        width: 100%;
      }

      .login-header {
        width: 180px;
        height: 75px;
      }

      .login-header h1 {
        font-size: 22px;
        letter-spacing: 2px;
      }

      .login-header .subtitle {
        font-size: 10px;
        letter-spacing: 1.5px;
      }

      .login-nav {
        flex-direction: column;
        gap: 15px;
        align-items: center;
      }

      .login-nav button {
        width: 100%;
        text-align: center;
      }

      .view-title {
        font-size: 20px;
      }
    }

    @media only screen and (max-width: 400px) {
      .login_box {
        padding: 7.5em 1em 4em 1em;
      }

      .login-header {
        width: 160px;
        height: 70px;
      }

      .login-header h1 {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
<div class="wrapper">
  <div class="login_box">
    <!-- Improved J.A.R.V.I.S. Header -->
    <div class="login-header">
      <h1>J.A.R.V.I.S.</h1>
      <div class="subtitle">Access Control</div>
    </div>

    <!-- Login View -->
    <div id="view-login" class="view active">
      <div class="view-header">
        <div class="view-title">Login</div>
        <div class="view-subtitle">System Identity Verification</div>
      </div>

      <!-- Custom Google Login Button -->
      <div class="google-wrapper" id="googleSignInBtn" onclick="handleGoogleSignIn()">
        <i class='bx bxl-google'></i>
        <span>Continue with Google</span>
      </div>

      <div class="divider">OR</div>

      <!-- Email & Password Inputs -->
      <div class="input_box">
        <input type="email" id="l_email" class="input-field" required>
        <label for="l_email" class="label">Email Address</label>
        <i class="bx bx-user icon"></i>
      </div>

      <div class="input_box">
        <input type="password" id="l_pass" class="input-field" required>
        <label for="l_pass" class="label">Password</label>
        <i class="bx bx-lock-alt icon"></i>
      </div>

      <div class="remember-forgot">
        <div class="remember-me">
          <input type="checkbox" id="remember">
          <label for="remember">Remember me</label>
        </div>
        <div class="forgot">
          <button onclick="switchView('forgot')">Forgot password?</button>
        </div>
      </div>

      <div class="input_box">
        <input type="submit" class="input-submit" value="Initialize Session" onclick="doLogin()">
      </div>

      <button class="btn-guest" onclick="handleGuestMode()">Access Guest Mode</button>

      <div class="login-nav">
        <button onclick="switchView('register')">Create ID</button>
        <button onclick="switchView('forgot')">Lost Access?</button>
      </div>

      <div class="register">
        <span>Don't have an account? <button onclick="switchView('register')">Register</button></span>
      </div>
    </div>

    <!-- Register View -->
    <div id="view-register" class="view">
      <div class="view-header">
        <div class="view-title">Register</div>
        <div class="view-subtitle">Create New Identity</div>
      </div>

      <div class="input_box">
        <input type="text" id="r_name" class="input-field" required>
        <label for="r_name" class="label">Full Name</label>
        <i class="bx bx-user icon"></i>
      </div>

      <div class="input_box">
        <input type="email" id="r_email" class="input-field" required>
        <label for="r_email" class="label">Email Address</label>
        <i class="bx bx-envelope icon"></i>
      </div>

      <div class="input_box">
        <input type="password" id="r_pass" class="input-field" required>
        <label for="r_pass" class="label">Create Password</label>
        <i class="bx bx-lock-alt icon"></i>
      </div>

      <div class="input_box">
        <input type="submit" class="input-submit" value="Create Record" onclick="doRegister()">
      </div>

      <div class="login-nav">
        <button onclick="switchView('login')">Back to Login</button>
      </div>
    </div>

    <!-- Forgot Password View -->
    <div id="view-forgot" class="view">
      <div class="view-header">
        <div class="view-title">Password Recovery</div>
        <div class="view-subtitle">Reset Your Password</div>
      </div>

      <div class="input_box">
        <input type="email" id="f_email" class="input-field" required>
        <label for="f_email" class="label">Registered Email</label>
        <i class="bx bx-envelope icon"></i>
      </div>

      <div class="input_box">
        <input type="submit" class="input-submit" value="Send Reset Code" onclick="requestReset()">
      </div>

      <div class="login-nav">
        <button onclick="switchView('login')">Back to Login</button>
        <button onclick="switchView('register')">Create Account</button>
      </div>
    </div>

    <!-- Reset Password View -->
    <div id="view-reset" class="view">
      <div class="view-header">
        <div class="view-title">Verify Identity</div>
        <div class="view-subtitle">Enter Verification Code</div>
      </div>

      <div class="input_box">
        <input type="text" id="rs_code" class="input-field" maxlength="6" required 
               style="text-align: center; letter-spacing: 15px; font-size: 20px; font-weight: bold;">
        <label for="rs_code" class="label">6-Digit Code</label>
        <i class="bx bx-key icon"></i>
      </div>

      <div class="input_box">
        <input type="password" id="rs_pass" class="input-field" required>
        <label for="rs_pass" class="label">New Password</label>
        <i class="bx bx-lock-alt icon"></i>
      </div>

      <div class="input_box">
        <input type="submit" class="input-submit" value="Update Credentials" onclick="confirmReset()">
      </div>

      <div class="login-nav">
        <button onclick="switchView('login')">Back to Login</button>
      </div>
    </div>

    <!-- Status Message Area -->
    <div id="status-msg" class="status-msg"></div>
  </div>
</div>

<!-- Hidden Google OAuth Button -->
<div id="g_id_onload"
     data-client_id="971723044178-n91t8i15nf9kgj4lj57kmst9lk3p8cii.apps.googleusercontent.com"
     data-callback="handleCredentialResponse"
     data-auto_prompt="false">
</div>

<!-- ORIGINAL JAVASCRIPT (Updated for custom Google button) -->
<script>
    // ==========================================================
    // 1. SYSTEM CONFIGURATION
    // ==========================================================
    
    const API_URL = "https://141170075787.ngrok-free.app";
    const MAIN_APP_URL = "index.html";

    // Check existing session
    if(localStorage.getItem('jarvis_role')) {
      window.location.href = MAIN_APP_URL;
    }

    // ==========================================================
    // 2. HELPER FUNCTIONS
    // ==========================================================
    function switchView(viewName) {
      document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
      document.getElementById('view-' + viewName).classList.add('active');
      document.getElementById('status-msg').innerText = "";
    }

    function showMsg(text, type='neutral') {
      const el = document.getElementById('status-msg');
      el.innerText = text;
      el.className = 'status-msg';
      if(type === 'error') el.classList.add('text-error');
      if(type === 'success') el.classList.add('text-success');
    }

    function enterJarvis(userData, role='verified') {
      console.log("Redirecting to J.A.R.V.I.S...");
      
      localStorage.setItem('jarvis_user', userData.name || "User");
      localStorage.setItem('jarvis_role', role);
      if(userData.email) localStorage.setItem('jarvis_email', userData.email);
      if(userData.picture) localStorage.setItem('jarvis_avatar', userData.picture);
      
      showMsg("Access Granted. Loading Interface...", "success");

      setTimeout(() => {
        window.location.href = MAIN_APP_URL;
      }, 700);
    }

    function decodeJwt(token) {
      var base64Url = token.split('.')[1];
      var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    // ==========================================================
    // 3. AUTHENTICATION LOGIC
    // ==========================================================

    // Custom Google Sign-in Handler
    function handleGoogleSignIn() {
      showMsg("Initializing Google Sign-in...", "neutral");
      
      // Trigger Google's built-in sign-in
      if (typeof google !== 'undefined' && google.accounts && google.accounts.id) {
        google.accounts.id.prompt();
      } else {
        showMsg("Google Sign-in not available. Please refresh.", "error");
      }
    }

    // Google OAuth Callback
    function handleCredentialResponse(response) {
      try {
        const payload = decodeJwt(response.credential);
        showMsg("Verifying Biometrics...", "neutral");

        // Send Welcome Email
        fetch(`${API_URL}/send_welcome`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name: payload.name, email: payload.email })
        }).catch(err => console.warn("Email trigger failed:", err));

        // Login immediately
        enterJarvis({
          name: payload.name,
          email: payload.email,
          picture: payload.picture
        });

      } catch (err) {
        console.error(err);
        showMsg("Google Auth Failed.", "error");
      }
    }

    // --- EMAIL LOGIN ---
    async function doLogin() {
      const email = document.getElementById('l_email').value;
      const password = document.getElementById('l_pass').value;

      if(!email || !password) return showMsg("Credentials Required", "error");
      showMsg("Authenticating...", "neutral");

      try {
        const res = await fetch(`${API_URL}/login`, {
          method: 'POST', headers: {'Content-Type':'application/json'},
          body: JSON.stringify({email, password})
        });

        if(res.ok) {
          const data = await res.json();
          enterJarvis({ name: data.name, email: email });
        } else {
          showMsg("Access Denied: Invalid Credentials", "error");
        }
      } catch (err) {
        console.error(err);
        showMsg("Server Unreachable. Check Ngrok.", "error");
      }
    }

    // --- REGISTER ---
    async function doRegister() {
      const name = document.getElementById('r_name').value;
      const email = document.getElementById('r_email').value;
      const password = document.getElementById('r_pass').value;

      if(!email || !password) return showMsg("All fields are required", "error");
      showMsg("Creating Identity...", "neutral");

      try {
        const res = await fetch(`${API_URL}/register`, {
          method: 'POST', headers: {'Content-Type':'application/json'},
          body: JSON.stringify({name, email, password})
        });

        if(res.ok) {
          enterJarvis({ name: name, email: email });
        } else {
          showMsg("Registration Failed. Email used?", "error");
        }
      } catch (err) {
        console.error(err);
        showMsg("Connection Error", "error");
      }
    }

    // --- GUEST MODE ---
    function handleGuestMode() {
      showMsg("Initializing Guest Protocols...", "success");
      setTimeout(() => {
        localStorage.setItem('jarvis_user', 'Guest User');
        localStorage.setItem('jarvis_role', 'guest');
        localStorage.removeItem('jarvis_avatar');
        window.location.href = MAIN_APP_URL;
      }, 500);
    }

    // --- PASSWORD RECOVERY ---
    let recoveryEmail = "";

    async function requestReset() {
      recoveryEmail = document.getElementById('f_email').value;
      if(!recoveryEmail) return showMsg("Email required", "error");
      showMsg("Contacting Server...", "neutral");

      try {
        await fetch(`${API_URL}/forgot-password`, {
          method: 'POST', headers: {'Content-Type':'application/json'},
          body: JSON.stringify({email: recoveryEmail})
        });
        switchView('reset');
        showMsg("Code sent to inbox.", "success");
      } catch (err) {
        showMsg("Network Error", "error");
      }
    }

    async function confirmReset() {
      const code = document.getElementById('rs_code').value;
      const new_password = document.getElementById('rs_pass').value;
      if(!code || !new_password) return showMsg("Missing Data", "error");

      try {
        const res = await fetch(`${API_URL}/reset-password`, {
          method: 'POST', headers: {'Content-Type':'application/json'},
          body: JSON.stringify({email: recoveryEmail, code, new_password})
        });

        if(res.ok) {
          showMsg("Password Updated. Logging in...", "success");
          setTimeout(() => switchView('login'), 1500);
        } else {
          showMsg("Invalid Code.", "error");
        }
      } catch (err) {
        showMsg("Update Failed", "error");
      }
    }

    // Initialize Google Sign-in
    window.onload = function() {
      if (typeof google !== 'undefined') {
        google.accounts.id.initialize({
          client_id: "971723044178-n91t8i15nf9kgj4lj57kmst9lk3p8cii.apps.googleusercontent.com",
          callback: handleCredentialResponse
        });
      }
    };
  </script>
</body>
</html>






